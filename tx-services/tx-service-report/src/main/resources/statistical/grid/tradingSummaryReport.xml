<?xml version="1.0" encoding="UTF-8" ?>
		<report
				xmlns="http://wtms.com/xml/statistical-1.0.xsd"
                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                xsi:schemaLocation="http://wtms.com/xml/statistical-1.0.xsd"
		code="tradingSummaryReport" type="pagedListGrid"  name="用户交易报表"
		>


<!-- 设计考虑根据report可以生成对应的页面：考虑技术：freemarker -->
<!-- sql解析：利用Mybatis进行支撑：该支撑后期我来支撑，需要升级Mybatis -> 3.4 版本，现在tx-parent有兼容问题 -->
<!-- report.type 要求能够通过实现接口进行扩展 -->
<!-- report.conditions.item.type 要求能够通过实现接口进行扩展 -->
<!-- report.views.item.type 要求能够通过实现接口进行扩展 -->

<!-- code:必填：值不能重复 -->
<!-- type:非必填：默认值为pagedListGrid 其他支持类型：listGrid|pagedListGrid 要求该类型支撑线性扩展1111 -->
<!-- name:非必填：如果为空取code值 -->

	<!-- 页面附加的javascript:非必填 -->
	<script></script>

	<!-- cols：非必填： 默认为2 如果条件项小于3，则自动修改对应值，如果为3的倍数，则为3，如果为2的倍数则为2 -->
	<conditions cols="3">
		<item id="clientName" name="客户名称" value="" type="input"/>
		<item id="clientLoginName" name="交易账户" value="" type="input"/>
		<item cssClass="Wdate" name="开始时间" id="minCreateDate"
			  value="" readonly="true" type="input"
			  onclick="WdatePicker({maxDate:'#F{$dp.$D(\'maxCreateDate\')}',dateFmt:'yyyy-MM-dd'});"
			  cssStyle="width:38%"/>

		<item cssClass="Wdate" name="结束时间"  type="input"
			  id="maxCreateDate"   readonly="true"
			  onclick="WdatePicker({minDate:'#F{$dp.$D(\'minCreateDate\')}',dateFmt:'yyyy-MM-dd',maxDate:'%y-%M-%d'});"
			  cssStyle="width:38%"/>

		<item id="tradingRecordType" name="交易类型" type="select"
			  enumClass="com.tx.local.clientaccount.model.CLATradingRecordTypeEnum"
			  items="{:全部}"
			  labelName="name"/>



	</conditions>
	
	<!-- fitColumns:非必填，默认值为false -->
	<views fitColumns="false" sqlMapperId="queryTradingSummaryReport" >
		<!-- formatter: -->
		<!-- width:非必填：默认值为 150 -->
		<!-- hidden:非必填：false -->
		<!-- frozen:非必填：false -->
		<item column="clientId" name="客户ID" />
		<item column="clientName" name="姓名/机构名称"   />
		<item column="clientLoginName" name="交易账户"  />
        <item column="tradingRecordType" name="交易业务类型"
			  type="enum" enumClass="com.tx.local.clientaccount.model.CLATradingRecordTypeEnum"
				refValue="name"/>
		<item column="sumAmount" name="成交金额"   type="number" statisticalType="sum" />
        <item column="recordNumber" name="交易笔数"  statisticalType="sum" />
        <item column="averageAmount" name="平均金额"  type="number"  />
	</views>

	<sqlMappers >
		<!-- datebaseId:非必填: 如果不填则databaseId为默认值 -->
		<sqlMapper id="queryTradingSummaryReport" >
			SELECT
			cr.clientId,
			cr.tradingRecordType,
			sum(abs(cr.sum)) AS sumAmount,
			avg(abs(cr.sum)) AS averageAmount,
			count(abs(cr.sum)) AS recordNumber,
			tc.userName AS clientName,
			tc.loginName AS clientLoginName
			FROM
			cla_ttr_capital_cr cr
			JOIN cl_client_info tc on cr.clientid =tc.id
			where 1 =1
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(clientName)">
				<![CDATA[ AND tc.userName  like concat('%', #{clientName} ,'%' )]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(clientLoginName)">
				<![CDATA[ AND tc.loginName = #{clientLoginName}]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(minCreateDate)">
				<![CDATA[ AND cr.createdate >= #{minCreateDate}]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(maxCreateDate)">
				<![CDATA[ AND cr.createdate <= #{maxCreateDate}]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(tradingRecordType)">
				<![CDATA[ AND cr.tradingRecordType = #{tradingRecordType}]]>
			</if>
			
			GROUP BY
			cr.clientId,
			cr.tradingRecordType
		</sqlMapper>

		<sqlMapper id="queryTradeTypeList" >
			select DISTINCT	cr.tradingRecordType
			FROM
			cla_ttr_capital_cr cr
		</sqlMapper>

	</sqlMappers>



</report>


