<?xml version="1.0" encoding="UTF-8" ?>
<report xmlns="http://wtms.com/xml/statistical-1.0.xsd"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://wtms.com/xml/statistical-1.0.xsd" code="tradingSummaryStatisticalReport"
	type="pagedListGrid" name="业务汇总报表">


	<!-- 设计考虑根据report可以生成对应的页面：考虑技术：freemarker -->
	<!-- sql解析：利用Mybatis进行支撑：该支撑后期我来支撑，需要升级Mybatis -> 3.4 版本，现在tx-parent有兼容问题 -->
	<!-- report.type 要求能够通过实现接口进行扩展 -->
	<!-- report.conditions.item.type 要求能够通过实现接口进行扩展 -->
	<!-- report.views.item.type 要求能够通过实现接口进行扩展 -->

	<!-- code:必填：值不能重复 -->
	<!-- type:非必填：默认值为pagedListGrid 其他支持类型：listGrid|pagedListGrid 要求该类型支撑线性扩展1111 -->
	<!-- name:非必填：如果为空取code值 -->

	<!-- 页面附加的javascript:非必填 -->
	<script></script>

	<!-- cols：非必填： 默认为2 如果条件项小于3，则自动修改对应值，如果为3的倍数，则为3，如果为2的倍数则为2 -->
	<conditions cols="3">
		<item id="clientName" name="客户名称" value="" type="input" />
		<item id="clientLoginName" name="交易账户" value="" type="input" />
		<item cssClass="Wdate" name="开始时间" id="minCreateDate"
			value="" readonly="true" type="input"
			onclick="WdatePicker({maxDate:'#F{$dp.$D(\'maxCreateDate\')}',dateFmt:'yyyy-MM-dd'});"
			cssStyle="width:38%" />

		<item cssClass="Wdate" name="结束时间" type="input" id="maxCreateDate"
			value="" readonly="true"
			onclick="WdatePicker({minDate:'#F{$dp.$D(\'minCreateDate\')}',dateFmt:'yyyy-MM-dd',maxDate:'%y-%M-%d'});"
			cssStyle="width:38%" />

		<item id="paymentChannel" name="交易渠道" type="select"
			enumClass="com.tx.component.basicdata.model.PaymentChannelEnum"
			labelName="name" />

	</conditions>

	<!-- fitColumns:非必填，默认值为false -->
	<views fitColumns="false" sqlMapperId="queryTradingSummaryReport">
		<!-- formatter: -->
		<!-- width:非必填：默认值为 150 -->
		<!-- hidden:非必填：false -->
		<!-- frozen:非必填：false -->
		<item column="CLIENTNAME" name="客户名称" />
		<item column="CLIENTLOGINNAME" name="客户登陆名" />
		<item column="MOBILEPHONENUMBER" name="手机号码" />
		<item column="PAYMENTCHANNEL" name="渠道"   type="enum" enumClass="com.tx.component.basicdata.model.PaymentChannelEnum" refValue="name"  />
		<item column="CAPITALFLOWTYPE" name="资金流水类型"   type="enum"  enumClass="com.tx.local.clientaccount.model.CapitalChangeTypeEnum" refValue="name"   />
		<item column="TRADINGRECORDTYPE" name="交易类型" type="enum" enumClass="com.tx.local.clientaccount.model.CLATradingRecordTypeEnum" refValue="name"/>
		<item column="SERVICETYPE" name="业务类型" type="enum" enumClass="com.tx.local.clientaccount.model.CLATradingRecordServiceTypeEnum" refValue="name"/>

		<item column="BEFORESUM" name="交易前金额" />
		<item column="SUM" name="成交金额" type="number" statisticalType="sum"/>
		<item column="AFTERSUM" name="交易后金额" type="number" />
		<item column="CREATEDATE" name="交易时间" type="date" />

	</views>

	<sqlMappers>
		<!-- datebaseId:非必填: 如果不填则databaseId为默认值 -->
		<sqlMapper id="queryTradingSummaryReport" >
			SELECT
			CR.TRADINGRECORDTYPE,
			CR.ID,
			CR.PAYMENTCHANNEL AS PAYMENTCHANNEL,
			CR.TRADINGRECORDSN,
			CR.TRADINGRECORDID,
			CR.CAPITALFLOWTYPE,
			CR.CLIENTID,
			CR.CLIENTACCOUNTID,
			CR.BEFORESUM,
			ABS(CR.SUM) AS SUM,
			CR.AFTERSUM,
			CR.CREATEDATE,
			CR.VOUCHER,
			CR.REMARK,
			CR.SERVICETYPE,
			TCI.USERNAME AS CLIENTNAME,
			TCI.MOBILEPHONENUMBER AS MOBILEPHONENUMBER,
			TCI.LOGINNAME AS CLIENTLOGINNAME,
			TCI.LOGINNAME
			FROM
			cla_ttr_capital_cr cr
			JOIN cl_client_info tci ON cr.clientId = tci.id
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(clientName)">
				<![CDATA[ AND tci.userName  like concat('%', #{clientName} ,'%' )]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(clientLoginName)">
				<![CDATA[ AND tci.loginName = #{clientLoginName}]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(minCreateDate)">
				<![CDATA[ AND cr.createdate >= #{minCreateDate}]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(maxCreateDate)">
				<![CDATA[ AND cr.createdate <= #{maxCreateDate}]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(paymentChannel)">
				<![CDATA[ AND CR.PAYMENTCHANNEL = #{paymentChannel}]]>
			</if>
			ORDER BY CR.CREATEDATE DESC
		</sqlMapper>
	</sqlMappers>
</report>


