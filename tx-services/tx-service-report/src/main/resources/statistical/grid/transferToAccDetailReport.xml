<?xml version="1.0" encoding="UTF-8" ?>
		<report
				xmlns="http://wtms.com/xml/statistical-1.0.xsd"
                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                xsi:schemaLocation="http://wtms.com/xml/statistical-1.0.xsd"
		code="transferToAccDetailReport" type="pagedListGrid"  name="转账明细报表"
		>


<!-- 设计考虑根据report可以生成对应的页面：考虑技术：freemarker -->
<!-- sql解析：利用Mybatis进行支撑：该支撑后期我来支撑，需要升级Mybatis -> 3.4 版本，现在tx-parent有兼容问题 -->
<!-- report.type 要求能够通过实现接口进行扩展 -->
<!-- report.conditions.item.type 要求能够通过实现接口进行扩展 -->
<!-- report.views.item.type 要求能够通过实现接口进行扩展 -->

<!-- code:必填：值不能重复 -->
<!-- type:非必填：默认值为pagedListGrid 其他支持类型：listGrid|pagedListGrid 要求该类型支撑线性扩展1111 -->
<!-- name:非必填：如果为空取code值 -->

	<!-- 页面附加的javascript:非必填 -->
	<script></script>

	<!-- cols：非必填： 默认为2 如果条件项小于3，则自动修改对应值，如果为3的倍数，则为3，如果为2的倍数则为2 -->
	<conditions cols="3">
		<item id="clientName" name="转出客户名称" value="" type="input"/>
		<item id="clientLoginName" name="转出交易账号" value="" type="input"/>
		<item id="transferToUserName" name="转入客户名称" value="" type="input"/>
		<item id="transferToLoginName" name="转入交易账号" value="" type="input"/>
		<item cssClass="Wdate" name="开始时间" id="minCreateDate"
			  value="" readonly="true" type="input"
			  onclick="WdatePicker({maxDate:'#F{$dp.$D(\'maxCreateDate\')}',dateFmt:'yyyy-MM-dd'});"
			  cssStyle="width:38%"/>

		<item cssClass="Wdate" name="结束时间"  type="input"
			  id="maxCreateDate"   value=""  readonly="true"
			  onclick="WdatePicker({minDate:'#F{$dp.$D(\'minCreateDate\')}',dateFmt:'yyyy-MM-dd',maxDate:'%y-%M-%d'});"
			  cssStyle="width:38%"/>



	</conditions>
	
	<!-- fitColumns:非必填，默认值为false -->
	<views fitColumns="false" sqlMapperId="queryTradingSummaryReport" >
		<!-- formatter: -->
		<!-- width:非必填：默认值为 150 -->
		<!-- hidden:非必填：false -->
		<!-- frozen:非必填：false -->
		<item column="serialNumber" name="流水号" />
		<item column="CLIENTNAME" name="客户名称" />
		<item column="CLIENTLOGINNAME" name="客户登陆名"   />
		<item column="MOBILEPHONENUMBER" name="电话号码" />

		<item column="beforeSum" name="交易前金额" type="number"/>
		<item column="sum" name="成交金额"   type="number" statisticalType="sum"/>
		<item column="afterSum" name="交易后金额"  type="number" />

		<item column="status" name="状态"  type="enum" enumClass="com.tx.local.clientaccount.model.TransferToAccountStatusEnum" refValue="name" />
        <item column="remark" name="备注"   />

		<item column="REFCLIENTNAME" name="收款人客户名称" />
		<item column="REFCLIENTLOGINNAME" name="收款人登录名称"   />
		<item column="REFMOBILEPHONENUMBER" name="收款人电话号码" />

        <item column="CREATEDATE" name="交易时间" type="date"   />
        <item column="lastTransferDate" name="转入时间" type="date"   />
	</views>

	<sqlMappers >
		<!-- datebaseId:非必填: 如果不填则databaseId为默认值 -->
		<sqlMapper id="queryTradingSummaryReport" >
			SELECT
			TTR.ID,
			TTR.serialNumber,
			TTR.transferToClientAccountId,
			TTR.transferToClientId,
			TTR.applyTradingRecordSN,
			TTR.clientAccountId,
			TTR.clientId,
			abs(TTR.sum) as sum,
			abs(TTR.poundageSum) as poundageSum,
			abs(TTR.factSum) as factSum,
			abs(TTR.beforeSum) as beforeSum,
			abs(TTR.afterSum) as afterSum,
			ttr.remark,
			ttr.status,
			TTR.lastTransferDate,
			TTR.CREATEDATE as CREATEDATE,
			CBCIOUT.USERNAME AS CLIENTNAME,
			CBCIOUT.LOGINNAME AS CLIENTLOGINNAME,
			CBCIOUT.MOBILEPHONENUMBER AS MOBILEPHONENUMBER,
			CBCIIN.USERNAME AS REFCLIENTNAME,
			CBCIIN.LOGINNAME AS REFCLIENTLOGINNAME,
			ifnull( CBCIIN.MOBILEPHONENUMBER,ttr.toClientMobilePhoneNumber) AS REFMOBILEPHONENUMBER
			FROM
			cla_transfer2acc_record TTR
			LEFT JOIN cl_client_info CBCIOUT ON CBCIOUT.ID = TTR.clientId
			LEFT JOIN cl_client_info CBCIIN ON CBCIIN.ID = TTR.transferToClientId
			WHERE 1 =1
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(status)">
				<![CDATA[ AND TTR.STATUS = #{status,jdbcType=VARCHAR} ]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(transferInClientAccountId)">
				<![CDATA[ AND TTR.TRANSFERINCLIENTACCOUNTID = #{transferInClientAccountId,jdbcType=VARCHAR} ]]>
			</if>

			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(sum)">
				<![CDATA[ AND TTR.sum = #{sum,jdbcType=NUMERIC} ]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(transferToClientAccountId)">
				<![CDATA[ AND TTR.transferToClientAccountId = #{transferToClientAccountId,jdbcType=VARCHAR} ]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(transferToClientId)">
				<![CDATA[ AND TTR.transferToClientId = #{transferToClientId,jdbcType=VARCHAR} ]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(clientId)">
				<![CDATA[ AND TTR.clientId = #{clientId,jdbcType=VARCHAR} ]]>
			</if>

			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(clientName)">
				<![CDATA[ AND CBCIOUT.USERNAME  like concat('%', #{clientName} ,'%' )]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(clientLoginName)">
				<![CDATA[ AND CBCIOUT.LOGINNAME = #{clientLoginName,jdbcType=VARCHAR} ]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(transferToUserName)">
				<![CDATA[ AND CBCIIN.USERNAME like concat('%', #{transferToUserName} ,'%' ) ]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(transferToLoginName)">
				<![CDATA[ AND CBCIIN.LOGINNAME = #{transferToLoginName,jdbcType=VARCHAR} ]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(maxCreateDate)">
				<![CDATA[ AND TTR.CREATEDATE <  DATE_ADD(#{maxCreateDate},INTERVAL 1 DAY)  ]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(minCreateDate)">
				<![CDATA[ AND TTR.CREATEDATE >= #{minCreateDate,jdbcType=TIMESTAMP} ]]>
			</if>
			ORDER BY TTR.CREATEDATE DESC
		</sqlMapper>
	</sqlMappers>
</report>


