<?xml version="1.0" encoding="UTF-8" ?>
<report
        xmlns="http://wtms.com/xml/statistical-1.0.xsd"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://wtms.com/xml/statistical-1.0.xsd"
        code="waitSettleInvestAccountReport" type="pagedListGrid" name="待投资待结算记录"
>

    <!-- 页面附加的javascript:非必填 -->
    <script>
        function projectNameFmt(value,row,index){
            var text="";
            if(!$.ObjectUtils.isEmpty(value)){
                var investProjectId = row.investProjectId;
                var now = new Date();
                if(now>row.nextSettleDate){
                    text= $.formatString('<a href="javascript:showInvestProjectDetail(\'{0}\',\'{1}\');"  style="text-decoration:underline;color:red;">{2}</a>',
                    investProjectId,row.name,value  );
                }else{
                    text= $.formatString('<a href="javascript:showInvestProjectDetail(\'{0}\',\'{1}\');"  style="text-decoration:underline;">{2}</a>',
                    investProjectId,row.name,value  );
                }
            }
            return text;

        }

        function showInvestProjectDetail(value,name){
            var url =	$.formatString(_contextPath+"/investProject/toInvestProjectTabs.action?status=INVEST_EFFICTIVE&#38;investProjectId={0}",value);
            $.triggerge("addOrSelectTab", {
            title : '[投资项目:]'+name,
            href : url
            });
        }


    </script>

    <!-- cols：非必填： 默认为2 如果条件项小于3，则自动修改对应值，如果为3的倍数，则为3，如果为2的倍数则为2 -->
    <conditions cols="3">
        <item id="userName" name="客户名称" value="" type="input"/>
        <item id="loginName" name="交易账户" value="" type="input"/>
        <item id="mobilePhoneNumber" name="电话号码" value="" type="input"/>

        <item id="minNextSettleDate" name="结算开始时间" type="input" value="" readOnly="true"
              onClick="WdatePicker({readOnly:true,dateFmt:'yyyy-MM-dd'})"/>
        <item id="maxNextSettleDate" name="结算结束时间" type="input" value="" readOnly="true"
              onClick="WdatePicker({readOnly:true,dateFmt:'yyyy-MM-dd'})"/>


    </conditions>

    <!-- fitColumns:非必填，默认值为false -->
    <views fitColumns="false" sqlMapperId="queryPageList">
        <item column="userName" name="客户名称"/>
        <item column="loginName" name="客户登陆名"/>
        <item column="mobilePhoneNumber" name="客户电话号码"/>
        <item column="name" name="投资项目" formatterFun="projectNameFmt"/>
        <item column="investAmount" name="投资金额" statisticalType="sum" type="money"/>
        <item column="receivableAmount" name="应收金额" statisticalType="sum"/>
        <item column="waitReceiveAmount" name="待收金额" statisticalType="sum"/>
        <item column="actualReceivedAmount" name="实收金额" statisticalType="sum"/>
        <item column="totalPeriod" name="总期数"/>
        <item column="currentPeriod" name="当前期数"/>
        <item column="nextSettleDate" name="下次结算时间" type="date"/>
    </views>

    <sqlMappers>
        <!-- datebaseId:非必填: 如果不填则databaseId为默认值 -->
        <sqlMapper id="queryPageList" datasourceId="">
            SELECT
            TIAID.investProjectId as investProjectId,
            TIAID.clientId,
            cl.userName,
            cl.loginName,
            cl.mobilePhoneNumber,
            p. name,
            TIAID.amount,
            TIAID.investAmount,
            TIAID.waitReceiveAmount,
            TIAID.actualReceivedAmount,
            TIAID.receivableAmount,
            TIAID.nextSettleDate,
            TIAID.currentPeriod,
            TIAID.totalPeriod,
            TIAID.`status`
            FROM
            IA_INVEST_ACCOUNT_ITEM TIAID
            LEFT JOIN cl_client_info cl ON TIAID.clientId = cl.id
            LEFT JOIN inv_invest_project p ON TIAID.investProjectId = p.id
            WHERE
            TIAID. STATUS = 'AC'
            <if test="@com.tx.core.util.OgnlUtils@isNotEmpty(mobilePhoneNumber)">
                <![CDATA[ AND cl.mobilePhoneNumber = #{mobilePhoneNumber,jdbcType=VARCHAR} ]]>
            </if>
            <if test="@com.tx.core.util.OgnlUtils@isNotEmpty(loginName)">
                <![CDATA[ AND cl.loginName = #{loginName,jdbcType=VARCHAR} ]]>
            </if>
            <if test="@com.tx.core.util.OgnlUtils@isNotEmpty(userName)">
                <![CDATA[ AND cl.userName = #{userName,jdbcType=VARCHAR} ]]>
            </if>
            <if test="@com.tx.core.util.OgnlUtils@isNotEmpty(minNextSettleDate)">
                <![CDATA[ AND TIAID.nextSettleDate >= #{minNextSettleDate,jdbcType=TIMESTAMP} ]]>
            </if>
            <if test="@com.tx.core.util.OgnlUtils@isNotEmpty(maxNextSettleDate)">
                <![CDATA[ AND TIAID.nextSettleDate <= #{maxNextSettleDate,jdbcType=TIMESTAMP} ]]>
            </if>

            ORDER BY nextSettleDate
        </sqlMapper>
    </sqlMappers>


</report>


