<?xml version="1.0" encoding="UTF-8" ?>
<report
		xmlns="http://wtms.com/xml/statistical-1.0.xsd"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://wtms.com/xml/statistical-1.0.xsd"
		code="reserveBalanceListReport" type="pagedListGrid"  name="自有资金扎差记录"
>


	<!-- 设计考虑根据report可以生成对应的页面：考虑技术：freemarker -->
	<!-- sql解析：利用Mybatis进行支撑：该支撑后期我来支撑，需要升级Mybatis -> 3.4 版本，现在tx-parent有兼容问题 -->
	<!-- report.type 要求能够通过实现接口进行扩展 -->
	<!-- report.conditions.item.type 要求能够通过实现接口进行扩展 -->
	<!-- report.views.item.type 要求能够通过实现接口进行扩展 -->

	<!-- code:必填：值不能重复 -->
	<!-- type:非必填：默认值为pagedListGrid 其他支持类型：listGrid|pagedListGrid 要求该类型支撑线性扩展1111 -->
	<!-- name:非必填：如果为空取code值 -->

	<!-- 页面附加的javascript:非必填 -->
	<script></script>

	<!-- cols：非必填： 默认为2 如果条件项小于3，则自动修改对应值，如果为3的倍数，则为3，如果为2的倍数则为2 -->
	<conditions cols="3">
		<!-- type:非必填： 默认为input 可选值:input|input_datetime|input_date  :预制类型要求能够扩展，如果没有预制的允许通过js等进行支撑 -->
		<!-- class:非必填：默认为text -->
		<!-- default:非必填：默认填写值 -->
		<!-- readOnly:非必填：默认为false -->
		<!--<item id="clientId" name="投资月份" type="input" readOnly="true" onClick="WdatePicker({readOnly:true,dateFmt:'yyyy-MM' })"/>-->
		<item id="minCreateDate" name="开始时间" type="input_date"/>
		<item id="maxCreateDate" name="结束时间" type="input_date"/>

		<!--&lt;!&ndash;<item id="mobilePhoneNumber" name="手机号码" type="input"/>&ndash;&gt;-->
		<item id="clientId" name="公司账户" type="select" sqlMapperId="reserveBalanceListReport.queryDgAccountList" labelName="name" labelValue="clientId" items="{:全部}" />
		<!--<item id="investProjectProductName" name="投资产品名称" type="select" items="{A:产品A},{B:产品B}"/>-->
		<item id="paymentChannel" name="渠道" type="select" enumClass="com.tx.component.basicdata.model.PaymentChannelEnum" labelName="name" items="{:全部}" />
		<!--<item id="tradingRecordType" name="交易类型" type="select"  items="{:全部,CASHOUT_APPLY:提现申请,TRANSFER_TO_ACCOUNT:交易转账}" />-->
		<item id="tradingRecordType" name="交易类型" type="select"  sqlMapperId="reserveBalanceListReport.queryTradeTypeList" items="{:全部}"  labelName="tradingRecordType" labelValue="tradingRecordType"/>

		<!--		<item id="investProductId" name="投资产品名称" type="select" datasource="" lableName="" lableValue=""/>
                <item id="investProductStatus" name="投资产品名称" type="select" items=""/>-->
	</conditions>

	<!-- fitColumns:非必填，默认值为false -->
	<views fitColumns="false" sqlMapperId="queryInvestProject" >
		<!-- formatter: -->
		<!-- width:非必填：默认值为 150 -->
		<!-- hidden:非必填：false -->
		<!-- frozen:非必填：false -->
		<item column="clientUserName" name="转出客户"/>
		<item column="paymentChannel" name="渠道"   type="enum" enumClass="com.tx.component.basicdata.model.PaymentChannelEnum" refValue="name"  />
		<item column="beforeAmount" name="转出客户交易前金额"   type="number"  />
		<item column="amount" name="转出金额" statisticalType="sum" type="number" />
		<item column="afterAmount" name="转出客户交易后金额"  type="number"   />
		<item column="transferToClientUserName" name="转入客户"/>
		<item column="tradingRecordType" name="交易类型" type="enum" enumClass="com.tx.local.clientaccount.model.CLATradingRecordTypeEnum" refValue="name" />
		<item column="createDate" name="交易時間" type="date"/>

	</views>

	<sqlMappers >
		<!-- datebaseId:非必填: 如果不填则databaseId为默认值 -->
		<sqlMapper id="queryInvestProject" datasourceId="">
			SELECT
			TTR.id,
			TTR.type,
			TTR.serialNumber,
			TTR.clientAccountId,
			TTR.clientId,
			TTR.transferClientAccountId,
			TTR.transferClientId,
			TTR.afterAmount,
			TTR.amount,
			TTR.beforeAmount,
			TTR.clientAccountItemId AS clientAccountItem_id,
			TTR.createDate,
			TTR.paymentChannel,
			TTR.tradingRecordsn AS tradingRecord_id,
			TTR.tradingRecordType,
			TTR.transferClientAccountItemId AS transferClientAccountItem_id,
			ftci.type AS clientType,
			ftci.mobilePhoneNumber as clientMobilePhoneNumber,
			ftci.email as clientEmail,
			ftci.userName as clientUserName,
			ftci.idCardType as clientIdCardType,
			ftci.idcardNumber as clientIdCardNumber,
			ftci.loginName as clientLoginName,
			ttci.type AS transferToClientType,
			ttci.mobilePhoneNumber as transferToClientMobilePhoneNumber,
			ttci.email as transferToClientEmail,
			ttci.userName as transferToClientUserName,
			ttci.idCardType as transferToClientIdCardType,
			ttci.idcardNumber as transferToClientIdCardNumber,
			ttci.loginName as transferToClientLoginName
			FROM CLA_TTR_TRANSFER_RECORD TTR
			LEFT JOIN cl_client_info ftci ON TTR.clientId = ftci.id
			LEFT JOIN cl_client_info ttci ON TTR.transferClientId = ttci.id
			where 1 = 1
			<!--AND tradingRecordType ='CASHOUT_TRANSFER_BALANCE'-->
			<!--<trim prefixOverrides="AND | OR">  tradingRecordType = 'CASHOUT_APPLY' -->
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(tradingRecordType)">
				<![CDATA[	AND TTR.tradingRecordType =#{tradingRecordType}	 ]]>
			</if>

			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(clientId)">
				<![CDATA[	AND ( TTR.clientId =#{clientId}
			or TTR.transferClientId = #{clientId}) ]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(paymentChannel)">
				<![CDATA[	AND TTR.paymentChannel =#{paymentChannel}	 ]]>
			</if>

			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(tradingRecordType)">
				<![CDATA[	AND TTR.tradingRecordType =#{tradingRecordType}	 ]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(minCreateDate)">
				<![CDATA[	AND TTR.createDate >= #{minCreateDate}	 ]]>
			</if>
			<if test="@com.tx.core.util.OgnlUtils@isNotEmpty(maxCreateDate)">
				<![CDATA[	AND TTR.createDate <= #{maxCreateDate}	 ]]>
			</if>

			<!--</trim>-->
		</sqlMapper>

		<datasource id="queryDgAccountList" datebaseId="">
			SELECT
			cl.id AS clientId,
			cla.id AS clientAccountId,
			cl.userName AS name
			FROM
			cl_client_info cl
			LEFT JOIN cla_client_account cla ON cl.id = cla.clientId
			WHERE
			cl.type = 'DG'
		</datasource>

		<datasource id="queryTradeTypeList" datebaseId="">
			select distinct tradingRecordType from CLA_TTR_TRANSFER_RECORD
		</datasource>

	</sqlMappers>

</report>


